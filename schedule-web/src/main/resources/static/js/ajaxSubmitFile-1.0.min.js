(function($) {
    $.fn.extend({
        submitImg: function(options) {
            var defaults = {
                action: '',
                type: 'file',
                verify: 'img',
                zindex: 99,
                before: function() {},
                success: function(txt, dom) {}
            };
            var opts = $.extend(defaults, options);
            var id = $(this).attr("id");
            var width = $(this).width();
            var height = $(this).height();
            var offset = $(this).offset();
            var file_upload_id = "file_upload_" + id;
            var file_upload_obj = $("#" + file_upload_id);
            if (file_upload_obj != null) {
                file_upload_obj.remove();
            }
            var objForm = '<div id=' + file_upload_id + ' style="width:' + width + 'px;height:' + height + 'px;position:absolute;overflow:hidden;';
            //objForm += 'left:' + (opts.left!=undefined?opts.left:offset.left) + 'px;top:' + (opts.top!=undefined?opts.top:offset.top) + 'px;">';
            objForm += 'left:' + offset.left + 'px;top:' + offset.top + 'px;">';
            objForm += '<form id="submitImg_form_' + id + '" action="' + opts.action + '" method="post" enctype="multipart/form-data">';
            objForm += '<input id="submitImg_file_' + id + '" name="submitImg_file_' + id + '" type="file" style="margin:0auto;cursor:pointer;z-index:' + opts.zindex + ';';
            objForm += 'position:absolute;width:'+width+'px;height:'+height+'px;opacity:0;filter:Alpha(opacity:0);"></form></div>';
            $("body").append(objForm);
            $("#submitImg_file_" + id).change(function() {
                if (verify()) {
                    opts.before();
                    $("#submitImg_form_" + id).submit();
                }
                return false;
            });
            function verify() {
                if ("img" == opts.verify) {
                    var fileFullName = $("#submitImg_file_" + id).val();
                    var strRegex = "(.jpg|.png|.gif|.bmp|.jpeg|.tiff)$";
                    var re = new RegExp(strRegex);
                    if(fileFullName == ""){
                    	return false;
                    }else if(re.test(fileFullName.toLowerCase())){
                        return true;
                    }else{
                        alert("该文件不是图片");
                        return false;
                    }
                }
                return true;
            }
            var thisObj = this;
            $("#submitImg_form_" + id).ajaxForm({
                success: function(txt) {
                    if ("json" == opts.type) {
                        return opts.success($.parseJSON(txt), thisObj);
                    } else {
                        return opts.success(txt, thisObj);
                    }
                }
            });
        },
        submitFile: function(options) {
            var defaults = {
                action: '',
                type: 'file',
                verify: 'excel',
                zindex: 99,
                before: function() {},
                success: function(txt, dom) {}
            };
            var opts = $.extend(defaults, options);
            var id = $(this).attr("id");
            var width = $(this).width();
            var height = $(this).height();
            var offset = $(this).offset();
            var file_upload_id = "file_upload_" + id;
            var file_upload_obj = $("#" + file_upload_id);
            if (file_upload_obj != null) {
                file_upload_obj.remove();
            }
            var objForm = '<div id=' + file_upload_id + ' style="width:' + width + 'px;height:' + height + 'px;position:absolute;overflow:hidden;left:' + offset.left + 'px;top:' + offset.top + 'px;"><form id="submitFile_form_' + id + '" action="' + opts.action + '" method="post" enctype="multipart/form-data"><input id="submitFile_file_' + id + '" name="submitFile_file_' + id + '" type="file" style="margin:0auto;cursor:pointer;text-align:right;z-index:' + opts.zindex + ';font-size:1000px;position:absolute;top:0px;right:0px;opacity:0;filter:Alpha(opacity:0);"></form></div>';
            $("body").append(objForm);
            $("#submitFile_file_" + id).change(function() {
                if (verify()) {
                    opts.before();
                    $("#submitFile_form_" + id).submit();
                }
                return false;
            });
            function verify() {
                if ("excel" == opts.verify) {
                    var fileFullName = $("#submitFile_file_" + id).val();
                    var strRegex = "(.xls|.xlsx)$";
                    var re = new RegExp(strRegex);
                    if(fileFullName == ""){
                    	return false;
                    }else if(re.test(fileFullName.toLowerCase())){
                        return true;
                    }else{
                        alert("该文件不是Excel");
                        return false;
                    }
                }
                return true;
            }
            var thisObj = this;
            $("#submitFile_form_" + id).ajaxForm({
                success: function(txt) {
                    if ("json" == opts.type) {
                        return opts.success($.parseJSON(txt), thisObj);
                    } else {
                        return opts.success(txt, thisObj);
                    }
                }
            });
        }
    })
})(jQuery);